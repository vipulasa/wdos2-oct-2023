<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking</title>
    <script src="//unpkg.com/alpinejs" defer></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>

<body>

    <div id="_app" x-data="_app" class="container">

        <div class="mt-4">
            <ul class="nav nav-tabs">
                <li class="nav-item" x-on:click="tab = 1">
                    <a class="nav-link" x-bind:class="tab == 1 ? 'active' : ''" aria-current="page" href="#">
                        Booking
                    </a>
                </li>
                <li class="nav-item" x-bind:class="tab == 2 ? 'active' : ''" x-on:click="tab = 2">
                    <a class="nav-link" href="#">Checkout</a>
                </li>
            </ul>
            <div class="border border-1 p-4">
                <div x-show="tab === 1">

                    <h5>
                        Select Room
                    </h5>

                    <div class="row">
                        <div class="form-floating mb-3 col-12">
                            <select type="date" x-model="booking.room_cost" class="form-control" id="room">
                                <option value="0">Select Room</option>
                                <option value="1000">Room 1</option>
                                <option value="2000">Room 2</option>
                                <option value="3000">Room 3</option>
                            </select>
                            <label for="room">Room</label>
                        </div>
                        <div class="form-floating mb-3 col">
                            <input type="date" x-model="booking.checkin" class="form-control" id="check-in" />
                            <label for="check-in">Check In Date</label>
                        </div>
                        <div class="form-floating mb-3 col">
                            <input type="date" x-model="booking.checkout" class="form-control" id="check-out" />
                            <label for="check-out">Check Out Date</label>
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-floating mb-3 col-12">
                            <input x-model="booking.number_of_rooms" type="number" class="form-control"
                                id="number-of-rooms" />
                            <label for="number-of-rooms">Number of Rooms</label>
                        </div>
                        <div class="form-floating mb-3 col">
                            <input x-model="booking.number_of_adults" type="number" class="form-control"
                                id="number-of-adults" />
                            <label for="number-of-adults">Number of Adults</label>
                        </div>
                        <div class="form-floating mb-3 col">
                            <input x-model="booking.number_of_children" type="number" class="form-control"
                                id="number-of-children" />
                            <label for="number-of-children">Number of Children</label>
                        </div>
                        <div class="form-floating mb-3 col">
                            <input x-model="booking.extra_bed" type="number" class="form-control"
                                id="number-of-children" />
                            <label for="number-of-children">Extra Bed</label>
                        </div>
                    </div>

                    <hr>

                    <h5>
                        Select Adventure
                    </h5>

                    <div class="row">
                        <div class="form-floating mb-3 col">
                            <input x-model="booking.adventure.number_of_adults_local" type="number" class="form-control"
                                id="number-of-adults-local" />
                            <label for="number-of-adults-local">Number of Adults (Local)</label>
                        </div>
                        <div class="form-floating mb-3 col">
                            <input x-model="booking.adventure.number_of_children_local" type="number"
                                class="form-control" id="number-of-children-local" />
                            <label for="number-of-children-local">Number of Children (Local)</label>
                        </div>
                        <div class="form-floating mb-3 col">
                            <input x-model="booking.adventure.number_of_adults_foreign" type="number"
                                class="form-control" id="number-of-adults-foreign" />
                            <label for="number-of-adults-foreign">Number of Adults (Foreign)</label>
                        </div>
                        <div class="form-floating mb-3 col">
                            <input x-model="booking.adventure.number_of_children_foreign" type="number"
                                class="form-control" id="number-of-children-foreign" />
                            <label for="number-of-children-foreign">Number of Children (Foreign)</label>
                        </div>

                        <div class="col-12 row">
                            <div class="form-floating mb-3 col">
                                <input x-model="booking.adventure.adult_guide" type="number" class="form-control"
                                    id="adult-guide" />
                                <label for="adult-guide">Adult Guide</label>
                            </div>
                            <div class="form-floating mb-3 col">
                                <input x-model="booking.adventure.child_guide" type="number" class="form-control"
                                    id="child-guide" />
                                <label for="child-guide">Child Guide</label>
                            </div>
                        </div>


                    </div>

                    <hr>

                    <h5>
                        Summary
                    </h5>

                    <div>
                        <div class="form-floating mb-3 col">
                            <input x-model="booking.promo_code" type="text" class="form-control" id="promo_code" />
                            <label for="promo_code">Promo Code</label>
                        </div>


                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th scope="col">Description</th>
                                    <th scope="col">Cost</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Room Cost</td>
                                    <td>
                                        LKR <span x-text="booking.room_cost * booking.number_of_rooms"></span>.00
                                    </td>
                                </tr>
                                <tr>
                                    <td>Adventure Cost</td>
                                    <td>
                                        LKR <span x-text="total_adventure_cost"></span>.00
                                    </td>
                                </tr>
                                <tr>
                                    <td>Total Cost</td>
                                    <td>
                                        LKR <span x-text="total_cost"></span>.00
                                    </td>
                                </tr>
                                <tr>
                                    <td>Total Discount</td>
                                    <td>
                                        LKR <span x-text="booking.total_discount"></span>.00
                                    </td>
                                </tr>
                                <tr>
                                    <td>Final Total</td>
                                    <td>
                                        LKR <span x-text="booking.final_total"></span>.00
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <button x-on:click="goToCheckout" class="btn btn-success">
                            Checkout
                        </button>
                    </div>
                </div>
                <div x-show="tab === 2">
                    <h5>
                        Summary
                    </h5>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th scope="col">Description</th>
                                <th scope="col">Cost</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Room Cost</td>
                                <td>
                                    LKR <span x-text="booking.room_cost * booking.number_of_rooms"></span>.00
                                </td>
                            </tr>
                            <tr>
                                <td>Adventure Cost</td>
                                <td>
                                    LKR <span x-text="total_adventure_cost"></span>.00
                                </td>
                            </tr>
                            <tr>
                                <td>Total Cost</td>
                                <td>
                                    LKR <span x-text="total_cost"></span>.00
                                </td>
                            </tr>
                            <tr>
                                <td>Total Discount</td>
                                <td>
                                    LKR <span x-text="booking.total_discount"></span>.00
                                </td>
                            </tr>
                            <tr>
                                <td>Final Total</td>
                                <td>
                                    LKR <span x-text="booking.final_total"></span>.00
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <hr>
                    <h5>
                        Checkout
                    </h5>
                    <div class="row">
                        <div class="form-floating mb-3 col">
                            <input type="text" class="form-control" id="name" />
                            <label for="name">Name</label>
                        </div>
                        <div class="form-floating mb-3 col">
                            <input type="text" class="form-control" id="email" />
                            <label for="email">Email</label>
                        </div>
                        <div class="form-floating mb-3 col">
                            <input type="text" class="form-control" id="phone" />
                            <label for="phone">Phone</label>
                        </div>
                        <div class="form-floating mb-3 col">
                            <input type="text" class="form-control" id="address" />
                            <label for="address">Address</label>
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-floating mb-3 col">
                            <input type="text" class="form-control" id="city" />
                            <label for="city">City</label>
                        </div>
                        <div class="form-floating mb-3 col">
                            <input type="text" class="form-control" id="country" />
                            <label for="country">Country</label>
                        </div>
                        <div class="form-floating mb-3 col">
                            <input type="text" class="form-control" id="postal-code" />
                            <label for="postal-code">Postal Code</label>
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-floating mb-3 col">
                            <input type="text" class="form-control" id="card-number" />
                            <label for="card-number">Card Number</label>
                        </div>
                        <div class="form-floating mb-3 col">
                            <input type="text" class="form-control" id="card-holder" />
                            <label for="card-holder">Card Holder</label>
                        </div>
                        <div class="form-floating mb-3 col">
                            <input type="text" class="form-control" id="expiry-date" />
                            <label for="expiry-date">Expiry Date</label>
                        </div>
                    </div>

                    <button class="btn btn-success">
                        Confirm Booking
                    </button>
                </div>
            </div>
        </div>



    </div>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('_app', () => ({

                coupons: [
                    'COUPON1',
                    'COUPON2',
                    'COUPON3',
                    'COUPON4',
                ],

                tab: 1,

                booking: {
                    checkin: null,
                    checkout: null,
                    room_cost: 0,
                    number_of_rooms: 0,
                    number_of_adults: 0,
                    number_of_children: 0,
                    extra_bed: 0,
                    promo_code: null,

                    // adventure
                    adventure: {
                        number_of_adults_local: 0,
                        number_of_adults_foreign: 0,
                        number_of_children_local: 0,
                        number_of_children_foreign: 0,
                        adult_guide: 0,
                        child_guide: 0
                    },

                    // final calculations
                    total_cost: 0,
                    discount_percentage: 0,
                    total_discount: 0,
                    final_total: 0,
                    final_adventure_cost: 0
                },

                get total_adventure_cost() {
                    let total = 0;
                    total += this.booking.adventure.number_of_adults_local * 1000;
                    total += this.booking.adventure.number_of_adults_foreign * 2000;
                    total += this.booking.adventure.number_of_children_local * 500;
                    total += this.booking.adventure.number_of_children_foreign * 1000;
                    total += this.booking.adventure.adult_guide * 1000;
                    total += this.booking.adventure.child_guide * 500;
                    this.booking.final_adventure_cost = total;
                    return total;
                },

                get total_cost() {
                    let total = 0;
                    total += this.booking.room_cost * this.booking.number_of_rooms;
                    total += this.total_adventure_cost;
                    this.booking.total_cost = total;

                    // calculate discount
                    this.booking.total_discount = total * (this.booking.discount_percentage / 100);

                    // calculate final total
                    this.booking.final_total = total - this.booking.total_discount;

                    return total;
                },

                goToCheckout() {
                    // change the tab to 2 (checkout)
                    this.tab = 2;

                    // save the booking to localstorage
                    localStorage.setItem('booking', JSON.stringify(this.booking));


                },


                checkLoyaltyPoints() {

                },

                init() {
                    // set booking checkin date to today
                    this.booking.checkin = new Date().toISOString().slice(0, 10);

                    // set booking checkout date to tomorrow
                    let tomorrow = new Date();


                    // watch booking.promo_code for changes and check if the code exists in the coupons array
                    this.$watch('booking.promo_code', (value) => {
                        if (this.coupons.includes(value)) {
                            // alert('Coupon Applied');
                            this.booking.discount_percentage = 10;
                        } else {
                            this.booking.discount_percentage = 0;
                        }
                    });

                    // check if there is a booking in localstorage and load it
                    if (localStorage.getItem('booking')) {
                        this.booking = JSON.parse(localStorage.getItem('booking'));
                    }

                }

            }));
        })
    </script>
</body>

</html>